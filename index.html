<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIY Sports Gel Calculator</title>
    <!-- Use Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            background-image: linear-gradient(to bottom right, #1a202c, #2d3748);
        }
        .gel-card {
            background-color: rgba(45, 55, 72, 0.7); /* Translucent background */
            backdrop-filter: blur(8px);
            border-radius: 1.5rem; /* More rounded corners */
            padding: 2.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2), 0 6px 6px rgba(0, 0, 0, 0.1);
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .result-box {
            background-color: #2d3748;
            border-radius: 0.75rem;
            padding: 1rem;
        }
    </style>
    <!-- Chart.js for the visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="flex items-center justify-center min-h-screen p-4 text-white">

    <!-- Main calculator container -->
    <div class="gel-card w-full max-w-xl mx-auto border border-gray-700">
        <!-- Title section with a fun icon -->
        <div class="flex items-center justify-center space-x-4 mb-8">
            <i class="fa-solid fa-seedling text-3xl text-green-400"></i>
            <h1 class="text-3xl sm:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-teal-400 to-sky-500">
                DIY Sports Gel Calculator
            </h1>
        </div>

        <!-- Target Carbs Input Section -->
        <div class="flex items-center justify-between space-x-4 mb-6 p-4 rounded-xl bg-gray-800 border border-gray-700">
            <label for="carbs-goal-input" class="text-white font-bold text-lg">Target Carbs:</label>
            <div class="flex items-center space-x-2 w-1/2">
                <input
                    id="carbs-goal-input"
                    type="number"
                    min="0"
                    placeholder="Enter goal"
                    class="flex-grow p-2 text-center bg-gray-700 border-2 border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                />
                <span class="text-gray-400 text-right">g</span>
            </div>
        </div>

        <!-- Input section for ingredients -->
        <div id="ingredients-container" class="space-y-4">
            <!-- Ingredient input fields will be dynamically added here by JavaScript -->
        </div>

        <!-- Spacer and Reset Button -->
        <div class="my-6 flex justify-center items-center relative">
            <hr class="flex-grow border-gray-600">
            <button id="reset-button" class="bg-gray-700 hover:bg-gray-600 text-white p-2 rounded-full absolute transition-transform transform hover:scale-110">
                <i class="fa-solid fa-arrows-rotate text-sm"></i>
            </button>
        </div>

        <!-- Results section -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center text-white font-semibold mb-8">
            <div class="result-box flex flex-col items-center justify-center space-y-2">
                <i class="fa-solid fa-weight-hanging text-2xl text-gray-400"></i>
                <span>Total Weight</span>
                <span id="total-weight" class="text-xl font-bold text-teal-300">0 g</span>
            </div>
            <div class="result-box flex flex-col items-center justify-center space-y-2">
                <i class="fa-solid fa-cubes text-2xl text-gray-400"></i>
                <span>Total Carbs</span>
                <span id="total-carbs" class="text-xl font-bold text-sky-300">0 g</span>
            </div>
            <div class="result-box flex flex-col items-center justify-center space-y-2">
                <i class="fa-solid fa-fire text-2xl text-gray-400"></i>
                <span>Total Calories</span>
                <span id="total-calories" class="text-xl font-bold text-orange-300">0 kcal</span>
            </div>
        </div>

        <!-- Chart visualization -->
        <div class="mb-8">
            <h2 class="text-xl font-bold text-center text-white mb-4">Nutritional Breakdown</h2>
            <canvas id="nutrition-chart"></canvas>
        </div>

        <!-- Disclaimer -->
        <p class="text-xs text-gray-400 text-center mt-4">
            Disclaimer: This calculator is for informational purposes only. Nutritional values may vary. Consult a professional before making dietary changes.
        </p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // The data from the original CSV file. These values are the totals for the default recipe.
            const ingredientsData = {
                "Maltodextrin": { weight: 96, carbs: 89.6, calories: 384 },
                "Fructose": { weight: 64, carbs: 64, calories: 240 },
                "Pectin": { weight: 2.5, carbs: 2.25, calories: 8.15 },
                "Sodium Alginate": { weight: 2, carbs: 0.38, calories: 4 },
                "Water": { weight: 110, carbs: 0, calories: 0 }
            };
            
            // Store the default weights to allow for resetting the calculator
            const defaultWeights = {};
            let initialTotalCarbs = 0;
            for (const ingredient in ingredientsData) {
                defaultWeights[ingredient] = ingredientsData[ingredient].weight;
                initialTotalCarbs += ingredientsData[ingredient].carbs;
            }

            // Get references to key DOM elements
            const ingredientsContainer = document.getElementById('ingredients-container');
            const totalWeightSpan = document.getElementById('total-weight');
            const totalCarbsSpan = document.getElementById('total-carbs');
            const totalCaloriesSpan = document.getElementById('total-calories');
            const chartCanvas = document.getElementById('nutrition-chart');
            const resetButton = document.getElementById('reset-button');
            const carbsGoalInput = document.getElementById('carbs-goal-input');

            let chartInstance = null;
            let currentWeights = { ...defaultWeights };

            // Function to dynamically create input fields for each ingredient
            function createInputFields() {
                for (const ingredient in ingredientsData) {
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between space-x-4';

                    div.innerHTML = `
                        <label for="${ingredient}-input" class="text-white w-2/5 font-medium">${ingredient}:</label>
                        <input
                            id="${ingredient}-input"
                            type="number"
                            value="${currentWeights[ingredient]}"
                            min="0"
                            class="flex-grow w-1/4 p-2 text-center bg-gray-800 border-2 border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                        />
                        <span class="text-gray-400 w-1/4 text-right">g</span>
                    `;
                    ingredientsContainer.appendChild(div);

                    const inputElement = document.getElementById(`${ingredient}-input`);
                    inputElement.addEventListener('input', (event) => {
                        const newWeight = parseFloat(event.target.value) || 0;
                        currentWeights[ingredient] = newWeight;
                        updateCalculations();
                    });
                }
            }

            // Function to update ingredient weights based on a target carb goal
            function updateWeightsFromCarbsGoal() {
                const targetCarbs = parseFloat(carbsGoalInput.value);
                if (isNaN(targetCarbs) || targetCarbs < 0 || initialTotalCarbs === 0) {
                    // Reset to default if input is invalid or initial carbs are zero
                    resetInputs();
                    return;
                }
                
                // Calculate the scaling factor based on the target carbs
                const scalingFactor = targetCarbs / initialTotalCarbs;

                // Update the current weights and the input fields
                for (const ingredient in defaultWeights) {
                    const newWeight = defaultWeights[ingredient] * scalingFactor;
                    currentWeights[ingredient] = newWeight;
                    const inputElement = document.getElementById(`${ingredient}-input`);
                    if (inputElement) {
                        inputElement.value = newWeight.toFixed(1);
                    }
                }
                updateCalculations();
            }

            // Function to update all calculations and the chart
            function updateCalculations() {
                let totalWeight = 0;
                let totalCarbs = 0;
                let totalCalories = 0;

                for (const ingredient in currentWeights) {
                    const weight = currentWeights[ingredient];
                    const data = ingredientsData[ingredient];
                    
                    const carbsPerGram = data.carbs / data.weight;
                    const caloriesPerGram = data.calories / data.weight;

                    totalWeight += weight;
                    totalCarbs += weight * carbsPerGram;
                    totalCalories += weight * caloriesPerGram;
                }

                totalWeightSpan.innerText = `${totalWeight.toFixed(1)} g`;
                totalCarbsSpan.innerText = `${totalCarbs.toFixed(1)} g`;
                totalCaloriesSpan.innerText = `${totalCalories.toFixed(1)} kcal`;

                const chartData = {
                    labels: ['Carbohydrates', 'Calories'],
                    datasets: [{
                        label: 'Nutritional Breakdown',
                        data: [totalCarbs, totalCalories],
                        backgroundColor: [
                            'rgba(14, 165, 233, 0.7)', // sky-500
                            'rgba(251, 146, 60, 0.7)'  // orange-400
                        ],
                        borderColor: [
                            '#0ea5e9',
                            '#fb923c'
                        ],
                        borderWidth: 1
                    }]
                };

                if (chartInstance) {
                    chartInstance.data = chartData;
                    chartInstance.update();
                } else {
                    chartInstance = new Chart(chartCanvas, {
                        type: 'doughnut',
                        data: chartData,
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    labels: {
                                        color: '#e2e8f0',
                                        font: {
                                            family: 'Inter',
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }

            // Function to reset all inputs to their default values
            function resetInputs() {
                currentWeights = { ...defaultWeights };
                for (const ingredient in currentWeights) {
                    const input = document.getElementById(`${ingredient}-input`);
                    if (input) {
                        input.value = currentWeights[ingredient];
                    }
                }
                // Clear the target carbs input as well
                carbsGoalInput.value = '';
                updateCalculations();
            }

            // Initialize the app
            createInputFields();
            updateCalculations();
            
            // Add event listeners for the new functionality
            carbsGoalInput.addEventListener('input', updateWeightsFromCarbsGoal);
            resetButton.addEventListener('click', resetInputs);
        });
    </script>
</body>
</html>

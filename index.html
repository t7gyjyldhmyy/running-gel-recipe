<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marathon Gel Calculator</title>
    <!-- Use Tailwind CSS for a sleek, modern, and responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-gray-100 text-gray-800;
        }

        /* Define keyframe animation for the results pop-in effect */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Apply the animation class */
        .results-animation {
            animation: fadeInScale 0.3s ease-out;
        }

        /* Add dynamic button press effect */
        #calculate-btn:active {
            transform: translateY(1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <!-- Main Container Card -->
    <div class="bg-white rounded-2xl shadow-xl p-8 max-w-lg w-full transform transition-all duration-300 hover:shadow-2xl">

        <!-- Header Section -->
        <header class="text-center mb-6">
            <h1 class="text-4xl font-bold text-blue-600 mb-2">DIY Gel Calculator</h1>
            <p class="text-sm text-gray-500">Fuel your run with the perfect recipe</p>
        </header>

        <!-- Input Section -->
        <div class="mb-6">
            <label for="carbs-input" class="block text-sm font-medium text-gray-700 mb-2">
                Total Carbs Desired (grams)
            </label>
            <input type="number" id="carbs-input" value="156.23" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
        </div>

        <!-- Calculation Button -->
        <button id="calculate-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200 mb-6">
            Calculate Recipe
        </button>

        <!-- Message Display Area -->
        <div id="message-area" class="text-center text-sm font-medium text-red-500 mb-4 hidden"></div>

        <!-- Results Section -->
        <div id="results-area" class="space-y-4">
            <!-- Ingredient list and totals will be dynamically generated here -->
        </div>
    </div>

    <!-- JavaScript logic for the calculator -->
    <script>
        // Use a self-executing anonymous function to prevent polluting the global scope
        (function() {
            // Define the base recipe data from the provided CSV file
            const baseRecipe = [
                { name: 'Maltodextrin', weight: 96, carbs: 89.6, calories: 384 },
                { name: 'Fructose', weight: 64, carbs: 64, calories: 240 },
                { name: 'Pectin', weight: 2.5, carbs: 2.25, calories: 8.15 },
                { name: 'Sodium Alginate', weight: 2, carbs: 0.38, calories: 4 },
                { name: 'Water', weight: 110, carbs: 0, calories: 0 },
            ];

            // Calculate the total carbs of the base recipe for scaling
            const baseCarbTotal = baseRecipe.reduce((sum, item) => sum + item.carbs, 0);

            // Get references to DOM elements
            const carbsInput = document.getElementById('carbs-input');
            const calculateBtn = document.getElementById('calculate-btn');
            const resultsArea = document.getElementById('results-area');
            const messageArea = document.getElementById('message-area');

            // Function to display messages to the user
            function showMessage(msg, isError = true) {
                messageArea.textContent = msg;
                messageArea.classList.toggle('text-red-500', isError);
                messageArea.classList.toggle('text-green-500', !isError);
                messageArea.classList.remove('hidden');
            }

            // Function to perform the calculation and update the UI
            function calculateAndDisplay() {
                const desiredCarbs = parseFloat(carbsInput.value);

                // Input validation: ensure the input is a positive number
                if (isNaN(desiredCarbs) || desiredCarbs <= 0) {
                    showMessage('Please enter a valid number greater than 0.');
                    resultsArea.innerHTML = '';
                    return;
                }

                // Hide any previous messages
                messageArea.classList.add('hidden');

                // Calculate the scaling factor based on the desired total carbs
                const scaleFactor = desiredCarbs / baseCarbTotal;

                let calculatedRecipeHtml = '';
                let totalWeight = 0;
                let totalCarbs = 0;
                let totalCalories = 0;

                // Loop through each ingredient, calculate new values, and build the display HTML
                baseRecipe.forEach(item => {
                    const newWeight = item.weight * scaleFactor;
                    const newCarbs = item.carbs * scaleFactor;
                    const newCalories = item.calories * scaleFactor;

                    totalWeight += newWeight;
                    totalCarbs += newCarbs;
                    totalCalories += newCalories;

                    calculatedRecipeHtml += `
                        <div class="bg-gray-50 rounded-lg p-4 flex justify-between items-center">
                            <span class="font-medium text-gray-800">${item.name}</span>
                            <div class="text-right">
                                <p class="text-lg font-bold text-gray-900">${newWeight.toFixed(1)} g</p>
                                <p class="text-xs text-gray-500">
                                    (${newCarbs.toFixed(1)} g carbs, ${newCalories.toFixed(1)} cal)
                                </p>
                            </div>
                        </div>
                    `;
                });

                // Add the totals section
                const totalsHtml = `
                    <div class="bg-blue-100 rounded-lg p-4 font-bold text-blue-800 flex justify-between items-center">
                        <span>Total:</span>
                        <div class="text-right">
                            <p class="text-lg">${totalWeight.toFixed(1)} g</p>
                            <p class="text-xs">
                                (${totalCarbs.toFixed(1)} g carbs, ${totalCalories.toFixed(1)} cal)
                            </p>
                        </div>
                    </div>
                `;

                // Update the results area with all the generated HTML
                resultsArea.innerHTML = calculatedRecipeHtml + totalsHtml;

                // Add animation class to trigger the effect
                resultsArea.classList.add('results-animation');

                // Remove the class after the animation to allow it to be re-triggered
                setTimeout(() => {
                    resultsArea.classList.remove('results-animation');
                }, 300);
            }

            // Event listeners
            calculateBtn.addEventListener('click', calculateAndDisplay);
            carbsInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    calculateAndDisplay();
                }
            });

            // Run the calculation on initial page load to show the default recipe
            calculateAndDisplay();
        })();
    </script>

</body>
</html>

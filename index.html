<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIY Sports Gel Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the app's font and layout */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background for a sleek look */
        }
        .gel-card {
            background-color: #2d3748; /* Darker card background */
            color: #e2e8f0; /* Light text color */
            border-radius: 1rem;
            padding: 2.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="gel-card w-full max-w-lg mx-auto">
        <h1 class="text-3xl font-bold text-center text-white mb-6">DIY Sports Gel Calculator</h1>

        <div id="ingredients-container" class="space-y-4">
            </div>

        <div class="my-6 border-b border-gray-600"></div>

        <div class="text-lg font-semibold space-y-2 mb-8">
            <p class="flex justify-between items-center">
                <span>Total Weight:</span>
                <span id="total-weight" class="font-bold text-gray-300">0 g</span>
            </p>
            <p class="flex justify-between items-center">
                <span>Total Carbs:</span>
                <span id="total-carbs" class="font-bold text-gray-300">0 g</span>
            </p>
            <p class="flex justify-between items-center">
                <span>Total Calories:</span>
                <span id="total-calories" class="font-bold text-gray-300">0 kcal</span>
            </p>
        </div>

        <div class="mb-8">
            <h2 class="text-xl font-bold text-center text-white mb-4">Nutritional Breakdown</h2>
            <canvas id="nutrition-chart"></canvas>
        </div>

        <p class="text-xs text-gray-400 text-center mt-4">
            Disclaimer: This calculator is for informational purposes only. Nutritional values may vary. Consult a professional before making dietary changes.
        </p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // The data from the CSV file, converted to a JavaScript object for easy use.
            const ingredientsData = {
                "Maltodextrin": { weight: 96, carbs: 0.9333, calories: 4 },
                "Fructose": { weight: 64, carbs: 1, calories: 3.75 },
                "Pectin": { weight: 2.5, carbs: 0.9, calories: 3.26 },
                "Sodium Alginate": { weight: 2, carbs: 0.19, calories: 2 },
                "Water": { weight: 110, carbs: 0, calories: 0 }
            };

            // Get references to key DOM elements
            const ingredientsContainer = document.getElementById('ingredients-container');
            const totalWeightSpan = document.getElementById('total-weight');
            const totalCarbsSpan = document.getElementById('total-carbs');
            const totalCaloriesSpan = document.getElementById('total-calories');
            const chartCanvas = document.getElementById('nutrition-chart');

            let chartInstance = null;
            let currentWeights = {};

            // Function to dynamically create input fields for each ingredient
            function createInputFields() {
                for (const ingredient in ingredientsData) {
                    const data = ingredientsData[ingredient];
                    currentWeights[ingredient] = data.weight; // Initialize with default weight

                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between space-x-4';

                    div.innerHTML = `
                        <label for="${ingredient}-input" class="text-white w-2/5 font-medium">${ingredient}:</label>
                        <input
                            id="${ingredient}-input"
                            type="number"
                            value="${data.weight}"
                            min="0"
                            class="flex-grow w-1/4 p-2 text-center bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors"
                        />
                        <span class="text-gray-400 w-1/4 text-right">g</span>
                    `;

                    ingredientsContainer.appendChild(div);

                    // Add an event listener to each input field
                    const inputElement = document.getElementById(`${ingredient}-input`);
                    inputElement.addEventListener('input', (event) => {
                        const newWeight = parseFloat(event.target.value) || 0;
                        currentWeights[ingredient] = newWeight;
                        updateCalculations();
                    });
                }
            }

            // Function to update all calculations and the chart
            function updateCalculations() {
                let totalWeight = 0;
                let totalCarbs = 0;
                let totalCalories = 0;

                for (const ingredient in currentWeights) {
                    const weight = currentWeights[ingredient];
                    const data = ingredientsData[ingredient];
                    
                    // The original CSV data showed the last two columns as a percentage, which implies a ratio.
                    // To make this a functional calculator, we'll use a standard nutritional calculation.
                    // This assumes the values in the CSV are per 100g.
                    // Let's re-parse the CSV data with a more logical structure.
                    // Re-calibrated based on standard nutritional data per gram:
                    // Maltodextrin: 4 kcal/g, 1g carbs/g
                    // Fructose: 4 kcal/g, 1g carbs/g
                    // Pectin: ~3 kcal/g, ~0.9g carbs/g
                    // Sodium Alginate: ~2 kcal/g, ~0.2g carbs/g
                    // Let's use the provided raw data instead for the most accurate calculation given the input.
                    
                    // The provided values seem to be totals for the initial recipe, not per gram.
                    // Let's recalculate the per-gram values from the CSV.
                    // Carbs per gram = Carbs(g) / Weight(g)
                    // Calories per gram = Calories(kcal) / Weight(g)
                    const carbsPerGram = data.carbs / data.weight;
                    const caloriesPerGram = data.calories / data.weight;

                    totalWeight += weight;
                    totalCarbs += weight * data.carbs;
                    totalCalories += weight * data.calories;
                }

                // Update the UI with the new totals
                totalWeightSpan.innerText = `${totalWeight.toFixed(1)} g`;
                totalCarbsSpan.innerText = `${totalCarbs.toFixed(1)} g`;
                totalCaloriesSpan.innerText = `${totalCalories.toFixed(1)} kcal`;

                // Update the chart
                const chartData = {
                    labels: ['Carbohydrates', 'Calories'],
                    datasets: [{
                        label: 'Total Nutritional Value',
                        data: [totalCarbs, totalCalories],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)'
                        ],
                        borderWidth: 1
                    }]
                };

                // Create or update the chart
                if (chartInstance) {
                    chartInstance.data = chartData;
                    chartInstance.update();
                } else {
                    chartInstance = new Chart(chartCanvas, {
                        type: 'doughnut',
                        data: chartData,
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    labels: {
                                        color: '#e2e8f0'
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            // Initialize the app
            createInputFields();
            updateCalculations();
        });
    </script>
</body>
</html>
